return ( loglkvalue)
}
loglk_full_data(exp(1))
return ( sumdi)
loglk_full_data = function(beta){
sumdi = log(beta)*sum(di)
sumti = sum((di+1)*log(1+beta*ti^2))
sumai = sum(log(1+beta*ai^2))
loglkvalue = sumdi - sumti +sumai
return ( sumdi)
}
loglk_full_data(exp(1))
sumti = sum((di+1)*log(1+ti^2))
sumti
loglk_full_data = function(beta){
sumdi = log(beta)*sum(di)
sumti = sum((di+1)*log(1+beta*ti^2))
sumai = sum(log(1+beta*ai^2))
loglkvalue = sumdi - sumti +sumai
return ( sumti)
}
loglk_full_data(1)
loglk_full_data = function(beta){
sumdi = log(beta)*sum(di)
sumti = sum((di+1)*log(1+beta*ti^2))
sumai = sum(log(1+beta*ai^2))
loglkvalue = sumdi - sumti +sumai
return ( loglkvalue)
}
beta_hat = optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$maximum
beta_hat #9.999994 for first 5 points
# likelihood ratio test
#H0: theta = 0.1, Ha: theta =/ 0.1 (simple hypothesis)
mle_loglk = optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$objective
ho_loglk = loglk_full_data(0.1)
test_stat = 2*(mleloglk - hologlk)
test_stat = 2*(mle_loglk - ho_loglk)
test_stat
qchisq(0.05)
qchisq(0.05, df=1)
qchisq(0.95, df=1)
test_stat
time = c(1.2, 2.1, 2.6, 3.6, 9.4, 0.8, 4.8, 5.5, 2.6, 6, 2.4, 5, 2.1, 1.6, 2.9, 5.6, 1.1, 3.8, 4.9, 19.8)
status = di = c(0,0,1,1,0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0)
survobj = Surv (time , status )
survobj
fitobj = survfit ( survobj ~1)
sumobj = summary ( fitobj )
sumobj
start = c(0, 1.2 ,0 ,0 ,0, 0.1, 2.5, 0.5, 0.8, 0, 0, 2.8, 0.9, 0, 0.3, 0, 0, 2.5, 1.6, 12.6)
end = c(1.2, 2.1, 2.6, 3.6, 9.4, 0.8, 4.8, 5.5, 2.6, 6, 2.4, 5, 2.1, 1.6, 2.9, 5.6, 1.1, 3.8, 4.9, 19.8)
status = c(0,0,1,1,0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0)
survobj = Surv (start, end, status )
fitobj = survfit ( survobj ~1)
sumobj = summary ( fitobj )
sumobj
plot (tsq ,expA ,pch =20 , xlab ="square of genuine failure time",ylab =
"exp(N-A estimate )")
tsq = (sumobj $ time)^2
expA =exp( sumobj $ cumhaz )
plot (tsq ,expA ,pch =20 , xlab ="square of genuine failure time",ylab =
"exp(N-A estimate )")
plot (tsq ,expA ,pch =20 , xlab ="square of genuine failure time",ylab =
"exp(N-A estimate )")
abline (lm( expA ~ tsq ) ,col ="red ")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )")
abline (lm( expA ~ tsq ) ,col ="red ")
head(veteran)
attach(veteran)
head(time)
detach(veteran)
detach(veteran)
coxvet=coxph(Surv(time,status)~trt+celltype+karno+diagtime+age+prior,data=veteran)
summary(coxvet)
str(veteran)
veteran$celltype <- as.numeric(veteran$celltype)
str(veteran)
coxvet=coxph(Surv(time,status)~trt+celltype+karno+diagtime+age+prior,data=veteran)
summary(coxvet)
str(veteran$celltype)
veteran$celltype
summary(coxvet)
coxvet
coxvet$coef
vetcoefs = coxvet$coef
vetcoefs$trt
vetcoefs[1]
logrelrisk = vetcoefs[1]*(2-1)+
vetcoefs[2]
logrelrisk = vetcoefs[1]*(2-1)+
vetcoefs[2]
logrelrisk = vetcoefs[1]*(2-1)+
vetcoefs[1]
vetcoefs = coxvet$coef
logrelrisk = vetcoefs[1]*(2-1)+
vetcoefs[2]
logrelrisk = vetcoefs[1]*(2-1)+
print(vetcoefs[2])
print(vetcoefs[3])
print(vetcoefs[4])
print(vetcoefs[5])
print(vetcoefs[6])
print(vetcoefs[7])
logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
relrisk = exp(logrelrisk)
relrisk
summary(coxvet)
logrelrisk
coef(coxvet)
coef(coxvet)$trt
coef(coxvet)[1]
coef(coxvet)[1]*2
logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
logrelrisk
vetcoefs[1]+vetcoefs[2]
vetcoefs[2]
vetcoefs[1]
logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
relrisk = exp(logrelrisk)
relrisk
survvet = survfit(coxvet, newdata=veteran(trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0) )
help("survfit.coxph")
# (trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0)
survvet = survfit(coxvet, newdata=veteran)
# (trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0)
survvet = survfit(coxvet, newdata=veteran, censor=FALSE)
summary(survvet)
survvet(trt=2)
survvet[trt=2]
survvet[trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0]
# (trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0)
survvet = survfit(coxvet, newdata=veteran[trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0], censor=FALSE)
# (trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0)
survvet = survfit(coxvet, newdata=veteran, censor=FALSE)
#survvet[trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0]
survvet
#survvet[trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0]
summary(survvet)
survvet$cumhaz
individualA = data.frame(trt=2, celltype=4, karno=80, diagtime=3, age=60, prior=0)
survvet = survfit (coxvet , newdata = individualA )
S= stepfun ( survvet $time ,c(1 , survvet $ surv ) )
S(1095)/S(730)
1-S(1095)/S(730)
#(d)
reduced_model = coxph(Surv(time,status)~trt+celltype+karno,data=veteran)
anova(reduced_model, coxvet, test = "LRT")
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt)+strata(prior),data=veteran)
sumcoxvetstrat=summary(coxvetstrat)
sumcoxvetstrat
survvetstrat=survfit(coxvetstrat,censor=FALSE)
survvetstrat=survfit(coxvetstrat,censor=FALSE)
#survvetstrat=survfit(coxvetstrat,censor=FALSE)
plot(survvetstrat$time,log(survvetstrat$cumhaz))
sumcoxvetstrat
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior),data=veteran)
sumcoxvetstrat=summary(coxvetstrat)
sumcoxvetstrat
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior),data=veteran)
summary(coxvetstrat)
coxvetstrat
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior)+celltype+karno+diagtime+age,data=veteran)
summary(coxvetstrat)
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior),data=veteran)
summary(coxvetstrat)
coxvetstrat
survvetstrat=survfit(coxvetstrat,censor=FALSE)
summary(survvetstrat)
#summary(survvetstrat)
plot(survvetstrat$time,log(survvetstrat$cumhaz))
#summary(survvetstrat)
plot(survvetstrat$time,log(survvetstrat$cumhaz))
#summary(survvetstrat)
#plot(survvetstrat$time,log(survvetstrat$cumhaz))
plot(survvetstrat$time,log(survvetstrat$cumhaz),type="s")
# plot attempt
library(ggplot2) #if package has not yet been installed, then do this via install.packages("ggplot2")
# plot attempt
install.packages("ggplot2")
# plot attempt
#install.packages("ggplot2")
library(ggplot2) #if package has not yet been installed, then do this via install.packages("ggplot2")
P=ggplot(NULL) +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow=
log(survvetstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col="
black") +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow
=log(survstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col
="blue")
P=ggplot(NULL) +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow=
log(survvetstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col="
black") +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow
=log(survvetstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col
="blue")
print(P)
#summary(survvetstrat)
#plot(survvetstrat$time,log(survvetstrat$cumhaz))
plot(survvetstrat$time,log(survvetstrat$cumhaz),type="s")
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior)+celltype+karno+diagtime+age,data=veteran)
summary(coxvetstrat)
#summary(survvetstrat)
#plot(survvetstrat$time,log(survvetstrat$cumhaz))
plot(survvetstrat$time,log(survvetstrat$cumhaz),type="s")
# plot attempt
#install.packages("ggplot2")
library(ggplot2)
P=ggplot(NULL) +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow=
log(survvetstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col="
black") +
geom_step(data=data.frame(time=survvetstrat$time[1:137],logbreslow
=log(survvetstrat$cumhaz[1:137])), aes(x=time,y=logbreslow),col
="blue")
print(P)
#summary(survvetstrat)
#plot(survvetstrat$time,log(survvetstrat$cumhaz))
plot(survvetstrat$time,log(survvetstrat$cumhaz),type="s")
#summary(survvetstrat)
plot(survvetstrat$time,log(survvetstrat$cumhaz))
# plot attempt
survvetstrat$time
# plot attempt
survvetstrat
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior)+celltype+karno+diagtime+age,data=veteran)
summary(coxvetstrat)
survvetstrat=survfit(coxvetstrat,censor=FALSE)
# plot attempt
survvetstrat
str(survvetstrat)
# plot attempt
c(survvetstrat$time, survvet$strata)
# plot attempt
data.frame(survvetstrat$time, survvet$strata)
survvet$strata
# plot attempt
survvetstrat
# plot attempt
survvetstrat$strata
str(survvetstrat)
P=ggplot(NULL) +
geom_step(data=data.frame(time=survvetstrat$time[trt=1, prior=0],logbreslow=
log(survvetstrat$cumhaz[trt=1, prior=0])), aes(x=time,y=logbreslow),col="
black")
P=ggplot(NULL) +
geom_step(data=data.frame(time=survvetstrat$time[trt=1, prior=0],logbreslow=
log(survvetstrat$cumhaz[trt=1, prior=0])), aes(x=time[trt=1, prior=0],y=logbreslow[trt=1, prior=0]),col="
black") +
print(P)
survvetstrat$time[trt = 1, prior = 0]
plot_data <- data.frame(
time = survvetstrat$time,
cumhaz = survvetstrat$cumhaz,
strata = rep(names(survvetstrat$strata), survvetstrat$strata)
)
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Cumulative Hazard Functions by Strata",
x = "Time",
y = "Log Cumulative Hazard") +
theme_minimal()
# Print the plot
print(P)
# Plot the cumulative hazard functions
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Cumulative Hazard Functions by Strata",
x = "Time",
y = "Log Cumulative Hazard")
# Print the plot
print(P)
# Plot the cumulative hazard functions
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Breslow estimates by Strata",
x = "Time",
y = "Log Breslow")
# Print the plot
print(P)
## Question 2(c) log rank test
library(survival)
times=c(16,28,30,40,42,43,9,12,20,25,32)
deathindic=c(0,1,0,1,0,1,1,0,1,1,0)
group=factor( c( rep(1,6),rep(2,5) ), levels=c(1,2), labels=c(
"Group a","Group b") )
survobj=Surv(times,deathindic)
survobj
survdiff(survobj~group)
survdiff(survobj~group)
survdiff(survobj~group) # fit survival function with groups
# fit survival function with groups
survdiff(survobj~group)
## Question 3(b) maximising likelihood
ai = c(0, 1.2 ,0 ,0 ,0, 0.1, 2.5, 0.5, 0.8, 0, 0, 2.8, 0.9, 0, 0.3, 0, 0, 2.5, 1.6, 12.6)
di = c(0,0,1,1,0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0)
ti = c(1.2, 2.1, 2.6, 3.6, 9.4, 0.8, 4.8, 5.5, 2.6, 6, 2.4, 5, 2.1, 1.6, 2.9, 5.6, 1.1, 3.8, 4.9, 19.8)
loglk_full_data = function(beta){
sumdi = log(beta)*sum(di)
sumti = sum((di+1)*log(1+beta*ti^2))
sumai = sum(log(1+beta*ai^2))
loglkvalue = sumdi - sumti +sumai
return ( loglkvalue)
}
beta_hat = optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$maximum
beta_hat #9.999994 for first 5 points
optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$maximum
# likelihood ratio test
#H0: theta = 0.1, Ha: theta =/ 0.1 (simple hypothesis)
mle_loglk = optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$objective
ho_loglk = loglk_full_data(0.1)
# likelihood ratio test
#H0: theta = 0.1, Ha: theta =/ 0.1 (simple hypothesis)
mle_loglk = optimize (loglk_full_data , interval =c(0 ,10) ,maximum = TRUE )$objective
ho_loglk = loglk_full_data(0.1)
test_stat = 2*(mle_loglk - ho_loglk)
test_stat
qchisq(0.95, df=1) # critical value 3.841459
survobj = Surv (start, end, status )
fitobj = survfit ( survobj ~1)
sumobj = summary ( fitobj )
tsq = (sumobj $ time)^2
expA =exp( sumobj $ cumhaz )
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )")
abline (lm( expA ~ tsq ) ,col ="red ")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )", title = "Plot of exp(Nelson-Aalen estimate) against squared genuine failure time")
abline (lm( expA ~ tsq ) ,col ="red ")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )", main = "Plot of exp(Nelson-Aalen estimate) against squared genuine failure time")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )", main = "Exp(Nelson-Aalen estimate) vs squared genuine failure time")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate )", main = "Exp(Nelson-Aalen estimate) vs (genuine failure time)^2")
abline (lm( expA ~ tsq ) ,col ="red ")
plot (tsq ,expA ,pch =20 , xlab ="genuine failure time squared",ylab =
"exp(N-A estimate)", main = "Exp(Nelson-Aalen estimate) vs (genuine failure time)^2")
plot (tsq ,expA ,pch =20 , xlab ="Genuine failure time squared",ylab =
"exp(N-A estimate)", main = "Exp(Nelson-Aalen estimate) vs (genuine failure time)^2")
plot (tsq ,expA ,pch =20 , xlab ="(Genuine failure time)^2",ylab =
"exp(N-A estimate)", main = "Exp(Nelson-Aalen estimate) vs (genuine failure time)^2")
abline (lm( expA ~ tsq ) ,col ="red ")
summary(lm(expA ~ tsq))
summary(lm(expA ~ tsq))$coefficients
coeffinfo = summary(lm(expA ~ tsq))$coefficients
coeffinfo$estimates
coeffinfo[1]
c(coeffinfo[1], coeffinfo[2])
veteran$celltype <- as.numeric(veteran$celltype)
str(veteran)
#veteran$celltype # celltype check
coxvet=coxph(Surv(time,status)~trt+celltype+karno+diagtime+age+prior,data=veteran)
plot (tsq ,expA ,pch =20 , xlab ="(Genuine failure time)^2",ylab =
"exp(N-A estimate)", main = "Exp(Nelson-Aalen estimate) vs (genuine failure time)^2")
summary(coxvet)
logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
relrisk = exp(logrelrisk)
relrisk
library(survival)
str(veteran)
library(survival)
str(veteran)
veteran$trt = factor(veteran$trt)
str(veteran)
veteran$trt = factor(veteran$trt, labels = c("standard", "test")
)
veteran$trt = factor(veteran$trt, labels = c("standard", "test"))
str(veteran)
veteran$prior = factor(veteran$prior, labels = c("no", "yes"))
str(veteran)
#veteran$celltype # celltype check
coxvet=coxph(Surv(time,status)~trt+celltype+karno+diagtime+age+prior,data=veteran)
summary(coxvet)
vetcoefs = coef(coxvet)
vetcoefs
vetcoefs[1]
vetcoefs[2]*(-1)
vetcoefs[4]
vetcoefs[5]*(80-60)
vetcoefs[6]*(3-6)
vetcoefs[7]*(60-75)
sum(vetcoefs, vetcoefs[1], vetcoefs[2]*(-1), vetcoefs[4], vetcoefs[5]*(80-60),
vetcoefs[6]*(3-6), vetcoefs[7]*(60-75))
logrelrisk = sum(vetcoefs, vetcoefs[1], vetcoefs[2]*(-1), vetcoefs[4], vetcoefs[5]*(80-60),
vetcoefs[6]*(3-6), vetcoefs[7]*(60-75))
#logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
relrisk = exp(logrelrisk)
relrisk
logrelrisk = sum(vetcoefs, vetcoefs[1], vetcoefs[2]*(-1), vetcoefs[4], vetcoefs[5]*(80-60),
vetcoefs[6]*(3-6), vetcoefs[7]*(60-75))
logrelrisk
#logrelrisk = vetcoefs[1]*(2-1)+vetcoefs[2]*(4-2)+vetcoefs[3]*(80-60)+vetcoefs[4]*(3-6)+vetcoefs[5]*(60-75)
relrisk = exp(logrelrisk)
relrisk
#(c)
individualA = data.frame(trt="test", celltype="large", karno=80, diagtime=3, age=60, prior="no")
survvet = survfit (coxvet , newdata = individualA )
S= stepfun ( survvet $time ,c(1 , survvet $ surv ) )
1-S(1095)/S(730)
#(d)
reduced_model = coxph(Surv(time,status)~trt+celltype+karno,data=veteran)
anova(reduced_model, coxvet, test = "LRT")
#(e)
coxvetstrat=coxph(Surv(time,status)~strata(trt, prior)+celltype+karno+diagtime+age,data=veteran)
summary(coxvetstrat)
survvetstrat=survfit(coxvetstrat,censor=FALSE)
#summary(survvetstrat)
plot(survvetstrat$time,log(survvetstrat$cumhaz))
plot(survvetstrat$time,log(survvetstrat$cumhaz),type="s")
# plot attempt
survvetstrat$strata
str(survvetstrat)
#copilot attempt
# Create a data frame for plotting
plot_data <- data.frame(
time = survvetstrat$time,
cumhaz = survvetstrat$cumhaz,
strata = rep(names(survvetstrat$strata), survvetstrat$strata)
)
# Plot the cumulative hazard functions
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Breslow estimates by Strata",
x = "Time",
y = "Log Breslow")
# Print the plot
print(P)
summary(survvetstrat)
summary(coxvetstrat)
summary(coxvetstrat)
#copilot attempt
# Create a data frame for plotting
plot_data <- data.frame(
time = survvetstrat$time,
cumhaz = survvetstrat$cumhaz,
strata = rep(names(survvetstrat$strata), survvetstrat$strata)
)
# Plot the cumulative hazard functions
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Breslow estimates by Strata",
x = "Time",
y = "Log Breslow")
# Print the plot
print(P)
# Plot the cumulative hazard functions
P <- ggplot(plot_data, aes(x = time, y = log(cumhaz), color = strata)) +
geom_step() +
labs(title = "Breslow-Estimates by Strata",
x = "Time",
y = "Log Breslow-Estimate")
# Print the plot
print(P)
install.packages("langaugeserver")
setwd("\\wsl.localhost\Ubuntu\home\xb25901\AHDS\Week_3\formative")
setwd("//wsl.localhost/Ubuntu/home/xb25901/AHDS/Week_3/formative")
df <- data.table::fread("data/original/BMX_D.csv")
# read in list of indexes to be in the sample and the BMX data
sampleIds <- read.table("data/derived/indexList_in.txt", header=F, col.names='Index')
BMXData <- read.csv("data/original/BMX_D.csv")
rm(list=ls())
# read in list of indexes to be in the sample and the BMX data
sampleIds <- read.table("data/derived/indexList_in.txt", header=F, col.names='Index')
BMXData <- read.csv("data/original/BMX_D.csv")
rm(list=ls())
# read in list of indexes to be in the sample and the BMX data
sampleIds <- read.table("data/derived/indexList_in.txt", header=F, col.names='Index')
BMXData <- read.csv("data/original/BMX_D.csv")
# add 1 indicator to all sampleIds entries - they will all be in the sample
sampleIds$hasData <- 1
head(sampleIds)
# add unique indexes from sampleIds and BMX data to allIds, preserving columns
allIds <- merge(BMXData, sampleIds, by.x='SEQN', by.y='Index', all.x=T, all.y=T)
head(allIds)
# replace NA values with 0 - these indexes unique to BMX data will not be in the sample
allIds$hasData[is.na(allIds$hasData)] <- 0
head(allIds)
# write sample csv
write.csv(x = allIds[,c('SEQN', 'hasData')], file="data/derived/sample.csv")
#check csv
sample <- read.csv("derived/sample.csv")
#check csv
sample <- read.csv("data/derived/sample.csv")
head(sample)
rm(list=ls())
# read in list of indexes to be in the sample and the BMX data
sampleIds <- read.table("data/derived/indexList_in.txt", header=F, col.names='Index')
BMXData <- read.csv("data/original/BMX_D.csv")
# add 1 indicator to all sampleIds entries - they will all be in the sample
sampleIds$inSample <- 1
head(sampleIds)
head(sampleIds)
# add unique indexes from sampleIds and BMX data to allIds, preserving columns
allIds <- merge(BMXData, sampleIds, by.x='SEQN', by.y='Index', all.x=T, all.y=T)
head(allIds)
# replace NA values with 0 - these indexes unique to BMX data will not be in the sample
allIds$inSample[is.na(allIds$inSample)] <- 0
head(allIds)
# write sample csv
write.csv(x = allIds[,c('SEQN', 'inSample')], file="data/derived/sample.csv")
#check csv
sample <- read.csv("data/derived/sample.csv")
head(sample)
